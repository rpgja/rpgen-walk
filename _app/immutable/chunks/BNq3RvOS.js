var B=Object.defineProperty;var k=i=>{throw TypeError(i)};var D=(i,e,s)=>e in i?B(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var g=(i,e,s)=>D(i,typeof e!="symbol"?e+"":e,s),y=(i,e,s)=>e.has(i)||k("Cannot "+s);var t=(i,e,s)=>(y(i,e,"read from private field"),s?s.call(i):e.get(i)),l=(i,e,s)=>e.has(i)?k("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,s),M=(i,e,s,a)=>(y(i,e,"write to private field"),a?a.call(i,s):e.set(i,s),s);import{c as w,r as F,d as b,p as C,a as x,b as A,h as j,e as q,m as z,s as E}from"./CYbKrHmN.js";var r,n,f,u,m,_;class I{constructor(e,s=!0){g(this,"anchor");l(this,r,new Map);l(this,n,new Map);l(this,f,new Map);l(this,u,!0);l(this,m,()=>{var e=w;if(t(this,r).has(e)){var s=t(this,r).get(e),a=t(this,n).get(s);if(a)F(a);else{var c=t(this,f).get(s);c&&(t(this,n).set(s,c.effect),t(this,f).delete(s),c.fragment.lastChild.remove(),this.anchor.before(c.fragment),a=c.effect)}for(const[h,o]of t(this,r)){if(t(this,r).delete(h),h===e)break;const d=t(this,f).get(o);d&&(b(d.effect),t(this,f).delete(o))}for(const[h,o]of t(this,n)){if(h===s)continue;const d=()=>{if(Array.from(t(this,r).values()).includes(h)){var v=document.createDocumentFragment();z(o,v),v.append(x()),t(this,f).set(h,{effect:o,fragment:v})}else b(o);t(this,n).delete(h)};t(this,u)||!a?C(o,d,!1):d()}}});l(this,_,e=>{t(this,r).delete(e);const s=Array.from(t(this,r).values());for(const[a,c]of t(this,f))s.includes(a)||(b(c.effect),t(this,f).delete(a))});this.anchor=e,M(this,u,s)}ensure(e,s){var a=w,c=E();if(s&&!t(this,n).has(e)&&!t(this,f).has(e))if(c){var h=document.createDocumentFragment(),o=x();h.append(o),t(this,f).set(e,{effect:A(()=>s(o)),fragment:h})}else t(this,n).set(e,A(()=>s(this.anchor)));if(t(this,r).set(a,e),c){for(const[d,p]of t(this,n))d===e?a.skipped_effects.delete(p):a.skipped_effects.add(p);for(const[d,p]of t(this,f))d===e?a.skipped_effects.delete(p.effect):a.skipped_effects.add(p.effect);a.oncommit(t(this,m)),a.ondiscard(t(this,_))}else j&&(this.anchor=q),t(this,m).call(this)}}r=new WeakMap,n=new WeakMap,f=new WeakMap,u=new WeakMap,m=new WeakMap,_=new WeakMap;export{I as B};
